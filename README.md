# gpdbbr
这是一个greenplum数据库的逻辑容灾工具，通过S3对象存储存储备份数据。

# 一、为什么要写该软件？
通过官方的gpbackup工具来实现容灾， 有这些缺点 ：
1. HEAP表不能增量备份
2. AO表发生了DDL就要备份，针对一些场景，比如历史数据归档的DDL操作，其实可以不备份。
3. 在备集群进行增量数据还原时，需要手工处理表结构。
4. 还原数据之后，没有数据校验。
5. 还原增量备份会依赖之前的备份信息，导致无法删除之前的备份。

# 二、如何实现该软件
1. 备份到s3和从s3中还原数据，使用现有的gpbackup的s3插件gpbackup_s3_plugin实现。
2. 数据库中通过触发器捕获DDL语句，捕获AO表的DDL，将DDL直接传递到备库执行。
3. HEAP表的增量备份，通过查询HEAP表操作系统文件的最大修改时间是否发生改变来判断HEAP表是否需要备份。同时捕获HEAP表的DDL语句，判断HEAP表是否需要备份。
4. 增量还原通过备份的增量信息，自动删除对象，并应用增量表结构。
5. 通过pg_stat_all_tables的记录信息对数据进行大致的对比。
