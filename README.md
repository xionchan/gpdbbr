# gpdbbr
这是一个greenplum数据库的逻辑容灾工具，通过S3对象存储存储备份数据。

# 一、为什么要做这个工具？
通过官方的gpbackup工具来实现容灾， 有这些缺点 ：
1. HEAP表不能增量备份
2. AO表发生了DDL就要备份，针对一些场景，比如历史数据归档的DDL操作，其实可以直接记录DDL操作就可以了。
3. 在备集群进行增量数据还原时，需要手工处理元数据信息。
4. 还原数据之后，没有数据校验。
5. 还原增量备份会依赖之前的备份信息，导致无法删除之前的备份。

# 二、如何实现该工具？
1. 使用gpbackup的s3插件gpbackup_s3_plugin实现备份数据到到s3和从s3中还原数据。
2. 通过触发器捕获DDL语句，捕获表的DDL，实现降低备份数据量的目的。
3. 通过查询HEAP表操作系统文件的最大修改时间是否发生改变来判断HEAP表是否需要备份。
4. 增量还原通过备份的增量信息，自动删除对象，并应用增量表结构。
5. 通过pg_stat_all_tables的记录信息对数据行数进行初略对比。
6. 构造工具元数据信息，实现备份和还原只依赖上一次备份，而无需依赖所有的备份集。
